# Causal Web

Causal_Web provides a small simulation engine and PySide6 GUI for exploring directed causal graphs. Nodes exchange phase-based "ticks" over weighted edges. Bridges create additional links whose strength may change over time, while observers infer hidden state from tick activity.

## Overview

Graphs are edited interactively. Nodes and observers can be placed with the mouse, connections are validated to avoid duplicates or self loops, and layouts can be auto-arranged using NetworkX. The engine drives the simulation and logs metrics under `output/`.

Key modules include:

- **`engine/models/graph.py`** – container for nodes, edges and bridges.
- **`engine/models/node.py`** – implementation of nodes and edges.
- **`engine/models/bridge.py`** – dynamic bridge management.
- **`engine/tick_engine/`** – simulation loop and tick routing.
- **`engine/logging/log_interpreter.py`** – converts raw logs into summaries.
- **`gui_pyside/`** – the PySide6 interface for editing graphs and running simulations.

Graphs load from `input/graph.json` by default. Use `--graph` or `Config.graph_file` to load a different file. All output is written next to the code inside the `output/` directory.

## Configuration

Runtime options are stored in `config.json` and can be overridden with CLI flags using `--<key>` notation. Common settings include:

- **tick thresholds** (`tick_threshold`, `tick_decay_factor`)
- **delay limits** (`max_cumulative_delay`, `refractory_period`)
- **edge behaviour** (`edge_weight_range`, `use_dynamic_density`)
- **concurrency** (`total_max_concurrent_firings`, `max_concurrent_firings_per_cluster`)
- **threading** (`thread_count`)
- **propagation control** (`enable_sip`, `enable_csp`)

Invoke a run with:

```bash
python -m Causal_Web.main --config Causal_Web/input/config.json --max_ticks 20
```

The `--init-db` flag initialises the PostgreSQL tables described in `database/` and then exits.

## Graph format

Graphs are JSON files describing nodes, edges, optional bridges, tick sources, observers and meta nodes. Observers may store their `(x, y)` position for the GUI. A minimal example is shown below:

```json
{
  "nodes": {
    "A": {"x": 100, "y": 100, "frequency": 1.0},
    "B": {"x": 100, "y": 200, "frequency": 1.0}
  },
  "edges": [{"from": "A", "to": "B", "delay": 1}],
  "tick_sources": [{"node_id": "A", "tick_interval": 2}]
}
```

## Running the simulation

Install dependencies with:

```bash
pip install -r requirements.txt pyside6
```

Launch the GUI or run headless:

```bash
python -m Causal_Web.main           # with GUI
python -m Causal_Web.main --no-gui  # headless
```

The dashboard lets you start, pause or stop the simulation, adjust tick rate and edit the graph. Each run stores its results under `output/runs/<timestamp>__<slug>`.

After a run you can interpret the logs with:

```bash
python -m Causal_Web.engine.logging.log_interpreter
```

This command aggregates metrics (`interpretation_log.json` and `interpretation_summary.txt`) and produces causal explanations.

## Output logs

Every run creates many JSON log files recording ticks, coherence, node state and more. They are buffered in memory and written periodically. See `docs/log_schemas.md` for the full schema. Important files include:

- `tick_trace.json` – snapshot of the graph and tick history
- `coherence_log.json` – node coherence values per tick
- `event_log.json` – high level events like bridge ruptures
- `causal_explanations.json` – explanation records generated by the analyst

Use `bundle_run.py` to collect the key outputs into an archive.

## Testing

Basic unit tests cover core behaviours such as interference detection and cluster formation. Run them with:

```bash
pytest
```

## Service objects

Large functions have been split into services located under `engine/services/` or the GUI package. Examples include `NodeTickService` for tick emission, `GraphLoadService` for reading graph files and `ConnectionDisplayService` for showing existing links. Utility mixins provide common logging and output directory helpers.

